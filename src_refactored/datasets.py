'''
Part of DK Laps Research
Supervised by Phd Dr Tannistha Maiti

Purpose: Minimal dataset wrapper around preprocessed NumPy assets produced by the wind-speed pipeline.


Contents:
	•	CustomDataset: Loads images and labels from .npy files; returns tensors normalized to  with the provided transform.
	•	transform: Default ToTensor + Normalize transform for images in -like ranges.
	•	Typical use: Point training scripts to the .npy files generated by the preprocessing pipeline for fast, deterministic experiments.

Last Adsjusted 2 Nov 2025 by Marawan Yakout
'''

import numpy as np
import torch
from torch.utils.data import Dataset
import torchvision.transforms as transforms

class CustomDataset(Dataset):
    def __init__(self, sfilename, lfilename, transform, null_context=False):
        self.sprites = np.load(sfilename)
        self.slabels = np.load(lfilename)
        print(f"sprite shape: {self.sprites.shape}")
        print(f"labels shape: {self.slabels.shape}")
        self.transform = transform
        self.null_context = null_context
        self.sprites_shape = self.sprites.shape
        self.slabel_shape = self.slabels.shape

    def __len__(self):
        return len(self.sprites)

    def __getitem__(self, idx):
        if self.transform:
            image = self.transform(self.sprites[idx])
            if self.null_context:
                label = torch.tensor(0).to(torch.int64)
            else:
                label = torch.tensor(self.slabels[idx]).to(torch.int64)
        return (image, label)

    def getshapes(self):
        return self.sprites_shape, self.slabel_shape

transform = transforms.Compose([
    transforms.ToTensor(),
    transforms.Normalize((0.5,), (0.5,)),
])
